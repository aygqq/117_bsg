# Changelog

## [5] - 2022-03-05
### Added
- Отправка телеметрии о включении на сервер МОТЗ при работе с сервером НИАЦ
- Добавлен ресет модема в случае долгого отсутствия (30 мин) сигнала GPS
### Changed
- Отменена синхронизация времени от сервера МОТЗ
- Отменено ожидание валидных координат для опроса ИУ, данные теперь будут идти с временем 2000г до синхронизации от GPS
### Fixed

## [3,4] - 2022-03-02
### Added
- Отправка геоданных на ИУ выделена в отдельный шаг, изменен порядок шагов
- Установка 1 января 2000г при запуске
- Добавлена отправка телеметрии KeepAlive до синхронизации времени (2, 7).
- Добавлена функция из ИУ для установки времени.
### Changed
- Изменение периода отправки геоданных на 60с только после остановки на более, чем 60с.
- Более частая синхронизация ИУ.
- Более частая отправка геоданных на ИУ.
- Отправка данных на сервер НИАЦ.
### Fixed
- Исправлен баг с граничной записью на странице.

## [1] - 2021-12-03
### Added
- Парсинг GPS с контролем ошибок, телеметрия (6, 15) при ошибках
- Телеметрия о синхронизации времени (6, 16)
### Changed
- Время синхронизируется от сервера при включении, затем стартует отправка данных БСГ
- Время синхронизируется от GPS когда появляется сигнал, затем начинается опрос ИУ
- Время синхронизируется каждый час от GPS, если есть сигнал
- Темеметрия по GPS перенесена в группу модема
### Fixed

## [9] - 2021-11-25
### Added
- Задача отправки пакетов переделана через диаграмму состояний
- Задача отправки пакетов переделана под сервер НИАЦ
- Работа с нашим сервером сохранена, рабочий сервер задается в bsgInit.
- Добавлены функции генерации и отправки пакетов авторизации и завершения сесии НИАЦ
- IMEI сохраняется и используется
### Changed
- Обновление теперь не бесконечное
- Упрощена обработка ошибок TCP
- Отключил обработку энергии
- Все индексы ППРУ теперь в первом байте телеметрии
### Fixed
### Removed
- Убрал повторы в отправке телеметрии при обновлении

## [8] - 2021-11-17
### Added
- Сделал заготовку для работы на два сервера, нужно проверять
- Окружил закрытие сессий мьютексами
### Changed
- Временно убрал синхронизацию через GPS
- Убрал отправку телеметрии от имени ИУ
### Fixed

### Removed

## [5] - 2021-11-16
### Added
- Генерация тестового пакета для документации
- Разрывы TCP соединений после отправки пачки пакетов
- Отправка раз в 15 секунд, если есть больше 256 байт данных.
- Синхронизация времени через GPS
- Добавлен парсинг новых данных GPS
- Добавлен запрос IMEI, пока он только выводится в консоль.
- Счетчики времени для оценки работы с сессиями
- Новый тип данных для GPS и для дверей
- Короткий формат геоданных для ИУ
### Changed
- Приём GPS переделан через idle прерывания
- Частота отправки GPS зависит от скорости
- Задача GPS теперь работает по состояниям
### Removed

## [3] - 2021-11-09
### Added
- Контроль синхронизации времени между ИУ и БСГ.
### Changed
- Опрос ИУ переделан через диаграму состояний.
- Соотнесены коды телеметрии с проектом ИУ.
- Мьютекс RTC теперь работает и на запись время.
- Минимальное число страниц для отправки уменьшено с 3 до 2.
- Исправлена телеметрия при перепрошивке ИУ.
- Отправка координат на сервер раз в 2 секунды, если скорость больше 5 км/ч.
- Отправка координат на ИУ чаще в 5 раз (20-30 сек).
### Removed

## [1] - 2021-10-14
- Первая версия БСГ проекта 127
- Есть документ со всеми типами и кодами данных для сервера
### Added
- Задача опроса ИУ
- Статистика модема, страниц памяти, ошибок в уартах (см документ)
- Телеметрия, связанная с ИУ
- Разделение отправки данных от своего UID и от UID ИУ
- Загрузка и передача новой прошивки на ИУ
- Проверка на принадлежность номера прошивки БСГ или ИУ к определенным диапазонам
- Подсчет общей контрольной суммы новой прошивки и запись ее в память
- Проверка бутом этой контрольной суммы и длины прошивки (20-200 КБ)
- Переход на крутое логгирование
- Работа с spiflash взята из БКТЭ_117
- Карта битых секторов spiflash, сохранение карты происходит один раз за полный круг по памяти.

### Changed
- Под загрузчик теперь выделено 2 сектора (8 КБ), 3й сектор под служебные данные
- GPS отправляем раз в 2 минуты
- Уменьшено время ожидания отправки TCP пакета с 90 до 40 сек.

### Removed